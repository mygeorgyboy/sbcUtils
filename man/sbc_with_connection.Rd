% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/db.R
\name{sbc_with_connection}
\alias{sbc_with_connection}
\title{Ejecutar función con gestión automática de conexión}
\usage{
sbc_with_connection(config, query_fn)
}
\arguments{
\item{config}{Configuración de conexión (lista con host, user, password, dbname, etc.)
\strong{Debe incluir campo \code{tipo}} con valor "mysql" o "db2"}

\item{query_fn}{Función que recibe la conexión como argumento y ejecuta consultas.
Debe devolver el resultado deseado}
}
\value{
El valor devuelto por \code{query_fn}
}
\description{
Abre una conexión a la base de datos, ejecuta la función proporcionada,
y cierra la conexión automáticamente incluso si ocurre un error.
Ideal para operaciones que requieren múltiples consultas.
}
\details{
El tipo de base de datos se detecta automáticamente desde el objeto config
(campo \code{tipo}), el cual es obligatorio.
}
\examples{
\dontrun{
# Configuración con tipo incluido (RECOMENDADO)
config_mysql <- list(
  tipo = "mysql",
  host = "localhost",
  user = "root",
  password = "secret",
  dbname = "mydb"
)

# Uso simple sin especificar tipo
datos <- sbc_with_connection(config_mysql, function(conn) {
  list(
    usuarios = sbc_query(conn, "SELECT * FROM usuarios"),
    productos = sbc_query(conn, "SELECT * FROM productos")
  )
})

# Con DB2
config_db2 <- list(
  tipo = "db2",
  host = "servidor.com",
  user = "db2user",
  password = "pass",
  dbname = "estudios",
  driver_path = "/path/to/db2jcc4.jar"
)

resultado <- sbc_with_connection(config_db2, function(conn) {
  sbc_query(conn, "SELECT COUNT(*) as total FROM tabla")
})
}
}

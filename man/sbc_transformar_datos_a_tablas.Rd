% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_transform.R
\name{sbc_transformar_datos_a_tablas}
\alias{sbc_transformar_datos_a_tablas}
\title{Transformar datos de encuestas a múltiples tablas relacionales}
\usage{
sbc_transformar_datos_a_tablas(
  data_book,
  datos_propiedades,
  id_encuesta_filter = NULL
)
}
\arguments{
\item{data_book}{tibble con definición de propiedades y estructura destino.
Debe contener las columnas: action, table, property, questionClass,
maxOccurrences, inLoop, loopMax, question. Opcionalmente: forEachValue.}

\item{datos_propiedades}{tibble con datos en formato largo (key-value).
Debe contener las columnas: id_estudio, id_encuesta, propiedad, valor.}

\item{id_encuesta_filter}{vector opcional de IDs de encuestas a procesar.
Si es NULL, se procesan todas las encuestas.}
}
\value{
Lista nombrada donde cada elemento es un tibble representando
una tabla relacional. Los nombres de la lista corresponden a los
valores únicos de la columna \code{table} en data_book.
}
\description{
Esta función transforma datos de encuestas desde un formato largo (key-value pairs)
a múltiples tablas relacionales basándose en un "libro de datos" (data_book)
que define la estructura destino.
}
\details{
La función maneja diferentes tipos de propiedades de encuestas:
\subsection{Tipos de Propiedades}{
\subsection{1. Propiedades Simples (\code{inLoop = "NO"})}{
\itemize{
\item Una columna por propiedad
\item Ejemplo: \code{sexo}, \code{edad}
}
}

\subsection{2. Propiedades Múltiples (\code{questionClass = "MULTIPLE_*"} + \code{inLoop = "NO"})}{
\itemize{
\item Múltiples columnas con sufijos: \code{marca_preferida_1}, \code{marca_preferida_2}
\item Para preguntas de selección múltiple
}
}

\subsection{3. Propiedades Loop While (\code{inLoop = "YES"} + \code{questionClass = "MULTIPLE_*"})}{
\itemize{
\item Patrón: \code{property_loopIdx_multipleIdx}
\item Ejemplo: \code{respuesta_1_1}, \code{respuesta_1_2}, \code{respuesta_2_1}
\item Se expanden a columnas múltiples por cada iteración
}
}

\subsection{4. Propiedades Loop ForEach (\code{inLoop = "YES"} + \code{forEachValue = "YES"})}{
\itemize{
\item Patrón simple: \code{property_loopIdx}
\item Ejemplo: \code{bebidas_consumo_ultimo_mes_desglosado_1}, \code{frecuencia_relativa_bebida_1}
\item Una columna por propiedad, agrupadas por \code{idx}
}
}

}

\subsection{Estructura del data_book_completo}{

El archivo \code{data_book_completo.xlsx} debe contener las siguientes columnas:
\itemize{
\item \code{action}: Define la acción para cada propiedad. Valores posibles:
\itemize{
\item \code{NA} o vacío: Procesar normalmente
\item \code{"ignorar"}: Excluir de la transformación
}
\item \code{table}: Nombre de la tabla destino (ej: "encuestas", "productos")
\item \code{property}: Nombre de la propiedad base
\item \code{questionClass}: Tipo de pregunta (SINGLE_FIXED_CHOICE, MULTIPLE_*, etc.)
\item \code{forEachValue}: "YES" para forzar tratamiento como loop simple
\item \code{maxOccurrences}: Máximo número de ocurrencias para preguntas múltiples
\item \code{inLoop}: "YES" si la propiedad está en un loop, "NO" si no
\item \code{loopMax}: Máximo número de iteraciones del loop
\item \code{question}: Texto de la pregunta (opcional, para documentación)
}
}
}
\examples{
\dontrun{
# Cargar data_book desde Excel
data_book <- openxlsx::read.xlsx("datos/data_book_completo.xlsx") |>
  tibble::tibble()

# Ejecutar transformación
tablas <- sbc_transformar_datos_a_tablas(data_book, estudio$propiedades)

# Acceder a tablas específicas
encuestas <- tablas$encuestas
productos <- tablas$productos
consumo_bebidas <- tablas$consumo_bebidas
}

}
\seealso{
\url{https://github.com/tu_usuario/sbcUtils} para más información sobre
el paquete y ejemplos adicionales.

Other data_transformation: 
\code{\link{ejemplo_data_book}},
\code{\link{sbc_crear_plantilla_data_book}()}
}
\concept{data_transformation}
